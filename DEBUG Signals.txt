>>> from nGS_Revised_Strategy import load_polygon_data
>>> test_symbols = ['AAPL', 'MSFT']
>>> print(f"Loading data for {len(test_symbols)} symbols...")
Loading data for 2 symbols...
>>> data = load_polygon_data(test_symbols)
2025-07-23 07:30:43,727 - nGS_Revised_Strategy - INFO - Loading data for 2 symbols
2025-07-23 07:30:43,728 - nGS_Revised_Strategy - INFO - Note: data_manager automatically filters to 6-month retention period
2025-07-23 07:30:43,789 - nGS_Revised_Strategy - INFO -
Completed loading data. Successfully loaded 2 out of 2 symbols

Loading batch 1/1 (2 symbols)...
>>> print(f"Loaded data for {len(data)} symbols")
Loaded data for 2 symbols
>>> results = backtester.compare_strategies(ngs_hierarchy, data)
2025-07-23 07:31:10,339 - data_manager - INFO - Loaded 502 S&P 500 symbols from data\sp500_symbols.txt
2025-07-23 07:31:10,339 - data_manager - INFO - Sample symbols: ['MMM', 'AOS', 'ABT', 'ABBV', 'ACN']...
2025-07-23 07:31:10,339 - data_manager - INFO - S&P 500 symbols loaded: 502
2025-07-23 07:31:10,340 - data_manager - INFO - ‚úî No duplicate symbols found
2025-07-23 07:31:10,340 - data_manager - INFO - ‚úÖ S&P 500 symbol validation passed
2025-07-23 07:31:10,340 - data_manager - INFO - Loaded 502 S&P 500 symbols from data\sp500_symbols.txt
2025-07-23 07:31:10,340 - data_manager - INFO - Sample symbols: ['MMM', 'AOS', 'ABT', 'ABBV', 'ACN']...
2025-07-23 07:31:10,340 - data_manager - INFO - S&P 500 Symbol Statistics:
2025-07-23 07:31:10,342 - data_manager - INFO -   Loaded: 502/500 symbols
2025-07-23 07:31:10,342 - data_manager - INFO -   Coverage Complete: False
2025-07-23 07:31:10,343 - data_manager - INFO -   Coverage Acceptable: True
2025-07-23 07:31:10,343 - data_manager - INFO -   Duplicates: 0
2025-07-23 07:31:10,343 - data_manager - INFO - Initializing sector classification data...
2025-07-23 07:31:10,355 - data_manager - INFO - Fetching fresh S&P 500 sector data...
2025-07-23 07:31:10,356 - data_manager - INFO - Loaded 502 S&P 500 symbols from data\sp500_symbols.txt
2025-07-23 07:31:10,356 - data_manager - INFO - Sample symbols: ['MMM', 'AOS', 'ABT', 'ABBV', 'ACN']...
2025-07-23 07:38:54,862 - data_manager - INFO - Wikipedia: Found 503 symbols in 129 sectors
2025-07-23 07:38:54,872 - data_manager - INFO - Cached sector data for 503 symbols
2025-07-23 07:38:54,872 - data_manager - INFO - ‚úÖ Loaded 503 symbols across 129 sectors
2025-07-23 07:38:54,874 - data_manager - INFO -   Industrial Conglomerates: 2 symbols (0.4%)
2025-07-23 07:38:54,874 - data_manager - INFO -   Building Products: 8 symbols (1.6%)
2025-07-23 07:38:54,874 - data_manager - INFO -   Health Care Equipment: 17 symbols (3.4%)
2025-07-23 07:38:54,874 - data_manager - INFO -   Biotechnology: 8 symbols (1.6%)
2025-07-23 07:38:54,874 - data_manager - INFO -   IT Consulting & Other Services: 5 symbols (1.0%)
2025-07-23 07:38:54,874 - data_manager - INFO -   Application Software: 13 symbols (2.6%)
2025-07-23 07:38:54,874 - data_manager - INFO -   Semiconductors: 14 symbols (2.8%)
2025-07-23 07:38:54,875 - data_manager - INFO -   Independent Power Producers & Energy Traders: 2 symbols (0.4%)
2025-07-23 07:38:54,875 - data_manager - INFO -   Life & Health Insurance: 5 symbols (1.0%)
2025-07-23 07:38:54,875 - data_manager - INFO -   Life Sciences Tools & Services: 8 symbols (1.6%)
2025-07-23 07:38:54,876 - data_manager - INFO -   Industrial Gases: 2 symbols (0.4%)
2025-07-23 07:38:54,877 - data_manager - INFO -   Hotels, Resorts & Cruise Lines: 8 symbols (1.6%)
2025-07-23 07:38:54,877 - data_manager - INFO -   Internet Services & Infrastructure: 3 symbols (0.6%)
2025-07-23 07:38:54,878 - data_manager - INFO -   Specialty Chemicals: 8 symbols (1.6%)
2025-07-23 07:38:54,878 - data_manager - INFO -   Office REITs: 2 symbols (0.4%)
2025-07-23 07:38:54,879 - data_manager - INFO -   Health Care Supplies: 3 symbols (0.6%)
2025-07-23 07:38:54,879 - data_manager - INFO -   Electric Utilities: 15 symbols (3.0%)
2025-07-23 07:38:54,879 - data_manager - INFO -   Property & Casualty Insurance: 8 symbols (1.6%)
2025-07-23 07:38:54,880 - data_manager - INFO -   Interactive Media & Services: 4 symbols (0.8%)
2025-07-23 07:38:54,880 - data_manager - INFO -   Tobacco: 2 symbols (0.4%)
2025-07-23 07:38:54,881 - data_manager - INFO -   Broadline Retail: 2 symbols (0.4%)
2025-07-23 07:38:54,881 - data_manager - INFO -   Paper & Plastic Packaging Products & Materials: 5 symbols (1.0%)
2025-07-23 07:38:54,882 - data_manager - INFO -   Multi-Utilities: 12 symbols (2.4%)
2025-07-23 07:38:54,884 - data_manager - INFO -   Consumer Finance: 3 symbols (0.6%)
2025-07-23 07:38:54,885 - data_manager - INFO -   Multi-line Insurance: 3 symbols (0.6%)
2025-07-23 07:38:54,885 - data_manager - INFO -   Telecom Tower REITs: 3 symbols (0.6%)
2025-07-23 07:38:54,886 - data_manager - INFO -   Water Utilities: 1 symbols (0.2%)
2025-07-23 07:38:54,886 - data_manager - INFO -   Asset Management & Custody Banks: 11 symbols (2.2%)
2025-07-23 07:38:54,887 - data_manager - INFO -   Electrical Components & Equipment: 5 symbols (1.0%)
2025-07-23 07:38:54,887 - data_manager - INFO -   Electronic Components: 2 symbols (0.4%)
2025-07-23 07:38:54,887 - data_manager - INFO -   Insurance Brokers: 6 symbols (1.2%)
2025-07-23 07:38:54,888 - data_manager - INFO -   Oil & Gas Exploration & Production: 10 symbols (2.0%)
2025-07-23 07:38:54,888 - data_manager - INFO -   Technology Hardware, Storage & Peripherals: 8 symbols (1.6%)
2025-07-23 07:38:54,889 - data_manager - INFO -   Semiconductor Materials & Equipment: 5 symbols (1.0%)
2025-07-23 07:38:54,889 - data_manager - INFO -   Automotive Parts & Equipment: 1 symbols (0.2%)
2025-07-23 07:38:54,890 - data_manager - INFO -   Agricultural Products & Services: 2 symbols (0.4%)
2025-07-23 07:38:54,890 - data_manager - INFO -   Communications Equipment: 4 symbols (0.8%)
2025-07-23 07:38:54,891 - data_manager - INFO -   Integrated Telecommunication Services: 2 symbols (0.4%)
2025-07-23 07:38:54,891 - data_manager - INFO -   Gas Utilities: 1 symbols (0.2%)
2025-07-23 07:38:54,892 - data_manager - INFO -   Human Resource & Employment Services: 4 symbols (0.8%)
2025-07-23 07:38:54,892 - data_manager - INFO -   Automotive Retail: 3 symbols (0.6%)
2025-07-23 07:38:54,893 - data_manager - INFO -   Multi-Family Residential REITs: 6 symbols (1.2%)
2025-07-23 07:38:54,893 - data_manager - INFO -   Aerospace & Defense: 12 symbols (2.4%)
2025-07-23 07:38:54,894 - data_manager - INFO -   Oil & Gas Equipment & Services: 3 symbols (0.6%)
2025-07-23 07:38:54,894 - data_manager - INFO -   Metal, Glass & Plastic Containers: 1 symbols (0.2%)
2025-07-23 07:38:54,895 - data_manager - INFO -   Diversified Banks: 7 symbols (1.4%)
2025-07-23 07:38:54,895 - data_manager - INFO -   Multi-Sector Holdings: 1 symbols (0.2%)
2025-07-23 07:38:54,895 - data_manager - INFO -   Computer & Electronics Retail: 1 symbols (0.2%)
2025-07-23 07:38:54,896 - data_manager - INFO -   Transaction & Payment Processing Services: 9 symbols (1.8%)
2025-07-23 07:38:54,896 - data_manager - INFO -   Pharmaceuticals: 7 symbols (1.4%)
2025-07-23 07:38:54,897 - data_manager - INFO -   Data Processing & Outsourced Services: 1 symbols (0.2%)
2025-07-23 07:38:54,897 - data_manager - INFO -   Distillers & Vintners: 2 symbols (0.4%)
2025-07-23 07:38:54,898 - data_manager - INFO -   Air Freight & Logistics: 4 symbols (0.8%)
2025-07-23 07:38:54,901 - data_manager - INFO -   Casinos & Gaming: 4 symbols (0.8%)
2025-07-23 07:38:54,901 - data_manager - INFO -   Packaged Foods & Meats: 12 symbols (2.4%)
2025-07-23 07:38:54,902 - data_manager - INFO -   Health Care Distributors: 4 symbols (0.8%)
2025-07-23 07:38:54,902 - data_manager - INFO -   Construction Machinery & Heavy Transportation Equipment: 4 symbols (0.8%)
2025-07-23 07:38:54,903 - data_manager - INFO -   Financial Exchanges & Data: 10 symbols (2.0%)
2025-07-23 07:38:54,903 - data_manager - INFO -   Real Estate Services: 2 symbols (0.4%)
2025-07-23 07:38:54,904 - data_manager - INFO -   Technology Distributors: 1 symbols (0.2%)
2025-07-23 07:38:54,904 - data_manager - INFO -   Managed Health Care: 5 symbols (1.0%)
2025-07-23 07:38:54,905 - data_manager - INFO -   Fertilizers & Agricultural Chemicals: 3 symbols (0.6%)
2025-07-23 07:38:54,905 - data_manager - INFO -   Investment Banking & Brokerage: 4 symbols (0.8%)
2025-07-23 07:38:54,905 - data_manager - INFO -   Cable & Satellite: 2 symbols (0.4%)
2025-07-23 07:38:54,906 - data_manager - INFO -   Integrated Oil & Gas: 2 symbols (0.4%)
2025-07-23 07:38:54,906 - data_manager - INFO -   Restaurants: 6 symbols (1.2%)
2025-07-23 07:38:54,907 - data_manager - INFO -   Household Products: 4 symbols (0.8%)
2025-07-23 07:38:54,907 - data_manager - INFO -   Health Care Services: 5 symbols (1.0%)
2025-07-23 07:38:54,908 - data_manager - INFO -   Diversified Support Services: 3 symbols (0.6%)
2025-07-23 07:38:54,908 - data_manager - INFO -   Regional Banks: 6 symbols (1.2%)
2025-07-23 07:38:54,909 - data_manager - INFO -   Soft Drinks & Non-alcoholic Beverages: 4 symbols (0.8%)
2025-07-23 07:38:54,909 - data_manager - INFO -   Consumer Staples Merchandise Retail: 5 symbols (1.0%)
2025-07-23 07:38:54,910 - data_manager - INFO -   Systems Software: 6 symbols (1.2%)
2025-07-23 07:38:54,910 - data_manager - INFO -   Rail Transportation: 3 symbols (0.6%)
2025-07-23 07:38:54,911 - data_manager - INFO -   Footwear: 1 symbols (0.2%)
2025-07-23 07:38:54,913 - data_manager - INFO -   Agricultural & Farm Machinery: 1 symbols (0.2%)
2025-07-23 07:38:54,914 - data_manager - INFO -   Passenger Airlines: 3 symbols (0.6%)
2025-07-23 07:38:54,915 - data_manager - INFO -   Data Center REITs: 2 symbols (0.4%)
2025-07-23 07:38:54,917 - data_manager - INFO -   Specialized Consumer Services: 1 symbols (0.2%)
2025-07-23 07:38:54,919 - data_manager - INFO -   Industrial Machinery & Supplies & Components: 14 symbols (2.8%)
2025-07-23 07:38:54,920 - data_manager - INFO -   Commodity Chemicals: 1 symbols (0.2%)
2025-07-23 07:38:54,922 - data_manager - INFO -   Homebuilding: 4 symbols (0.8%)
2025-07-23 07:38:54,923 - data_manager - INFO -   Interactive Home Entertainment: 2 symbols (0.4%)
2025-07-23 07:38:54,924 - data_manager - INFO -   Research & Consulting Services: 2 symbols (0.4%)
2025-07-23 07:38:54,925 - data_manager - INFO -   Personal Care Products: 3 symbols (0.6%)
2025-07-23 07:38:54,926 - data_manager - INFO -   Reinsurance: 1 symbols (0.2%)
2025-07-23 07:38:54,927 - data_manager - INFO -   Self-Storage REITs: 2 symbols (0.4%)
2025-07-23 07:38:54,929 - data_manager - INFO -   Trading Companies & Distributors: 2 symbols (0.4%)
2025-07-23 07:38:54,930 - data_manager - INFO -   Retail REITs: 5 symbols (1.0%)
2025-07-23 07:38:54,933 - data_manager - INFO -   Automobile Manufacturers: 3 symbols (0.6%)
2025-07-23 07:38:54,936 - data_manager - INFO -   Broadcasting: 3 symbols (0.6%)
2025-07-23 07:38:54,938 - data_manager - INFO -   Copper: 1 symbols (0.2%)
2025-07-23 07:38:54,939 - data_manager - INFO -   Consumer Electronics: 1 symbols (0.2%)
2025-07-23 07:38:54,940 - data_manager - INFO -   Heavy Electrical Equipment: 1 symbols (0.2%)
2025-07-23 07:38:54,941 - data_manager - INFO -   Distributors: 3 symbols (0.6%)
2025-07-23 07:38:54,943 - data_manager - INFO -   Leisure Products: 1 symbols (0.2%)
2025-07-23 07:38:54,944 - data_manager - INFO -   Health Care Facilities: 2 symbols (0.4%)
2025-07-23 07:38:54,945 - data_manager - INFO -   Health Care REITs: 3 symbols (0.6%)
2025-07-23 07:38:54,946 - data_manager - INFO -   Home Improvement Retail: 2 symbols (0.4%)
2025-07-23 07:38:54,948 - data_manager - INFO -   Hotel & Resort REITs: 2 symbols (0.4%)
2025-07-23 07:38:54,949 - data_manager - INFO -   Advertising: 3 symbols (0.6%)
2025-07-23 07:38:54,950 - data_manager - INFO -   Single-Family Residential REITs: 1 symbols (0.2%)
2025-07-23 07:38:54,955 - data_manager - INFO -   Other Specialized REITs: 1 symbols (0.2%)
2025-07-23 07:38:54,956 - data_manager - INFO -   Cargo Ground Transportation: 2 symbols (0.4%)
2025-07-23 07:38:54,958 - data_manager - INFO -   Electronic Manufacturing Services: 2 symbols (0.4%)
2025-07-23 07:38:54,959 - data_manager - INFO -   Construction & Engineering: 2 symbols (0.4%)
2025-07-23 07:38:54,962 - data_manager - INFO -   Electronic Equipment & Instruments: 5 symbols (1.0%)
2025-07-23 07:38:54,963 - data_manager - INFO -   Oil & Gas Storage & Transportation: 4 symbols (0.8%)
2025-07-23 07:38:54,964 - data_manager - INFO -   Food Retail: 1 symbols (0.2%)
2025-07-23 07:38:54,965 - data_manager - INFO -   Movies & Entertainment: 5 symbols (1.0%)
2025-07-23 07:38:54,967 - data_manager - INFO -   Apparel, Accessories & Luxury Goods: 4 symbols (0.8%)
2025-07-23 07:38:54,969 - data_manager - INFO -   Oil & Gas Refining & Marketing: 3 symbols (0.6%)
2025-07-23 07:38:54,971 - data_manager - INFO -   Construction Materials: 2 symbols (0.4%)
2025-07-23 07:38:54,973 - data_manager - INFO -   Home Furnishings: 1 symbols (0.2%)
2025-07-23 07:38:54,976 - data_manager - INFO -   Brewers: 1 symbols (0.2%)
2025-07-23 07:38:54,977 - data_manager - INFO -   Gold: 1 symbols (0.2%)
2025-07-23 07:38:54,978 - data_manager - INFO -   Publishing: 2 symbols (0.4%)
2025-07-23 07:38:54,980 - data_manager - INFO -   Steel: 2 symbols (0.4%)
2025-07-23 07:38:54,981 - data_manager - INFO -   Industrial REITs: 1 symbols (0.2%)
2025-07-23 07:38:54,982 - data_manager - INFO -   Environmental & Facilities Services: 4 symbols (0.8%)
2025-07-23 07:38:54,984 - data_manager - INFO -   Apparel Retail: 2 symbols (0.4%)
2025-07-23 07:38:54,989 - data_manager - INFO -   Health Care Technology: 1 symbols (0.2%)
2025-07-23 07:38:54,990 - data_manager - INFO -   Food Distributors: 1 symbols (0.2%)
2025-07-23 07:38:54,992 - data_manager - INFO -   Wireless Telecommunication Services: 1 symbols (0.2%)
2025-07-23 07:38:54,994 - data_manager - INFO -   Other Specialty Retail: 2 symbols (0.4%)
2025-07-23 07:38:54,995 - data_manager - INFO -   Passenger Ground Transportation: 1 symbols (0.2%)
2025-07-23 07:38:54,996 - data_manager - INFO -   Drug Retail: 1 symbols (0.2%)
2025-07-23 07:38:54,997 - data_manager - INFO -   Timber REITs: 1 symbols (0.2%)
2025-07-23 07:38:54,998 - data_manager - INFO -   Homefurnishing Retail: 1 symbols (0.2%)
2025-07-23 07:38:55,001 - data_manager - INFO - Data retention policy: 180 days (6 months)
2025-07-23 07:38:55,004 - data_manager - INFO - Current cutoff date: 2025-01-24
2025-07-23 07:38:55,006 - data_manager - INFO - Data manager initialized with 6-month retention and sector support
2025-07-23 07:38:55,070 - nGS_Revised_Strategy - INFO - Attempting to load 73 positions from data manager
2025-07-23 07:38:55,073 - nGS_Revised_Strategy - INFO - Loaded 73 positions within 180-day retention period
2025-07-23 07:38:55,073 - nGS_Revised_Strategy - INFO - nGS Strategy initialized with 180-day data retention
2025-07-23 07:38:55,075 - nGS_Revised_Strategy - INFO - Data cutoff date: 2025-01-24
2025-07-23 07:38:55,077 - nGS_Revised_Strategy - INFO - üéØ M/E rebalancing: ENABLED
2025-07-23 07:38:55,078 - nGS_Revised_Strategy - INFO - üéØ M/E target range: 50.0-80.0%
2025-07-23 07:38:55,079 - nGS_Revised_Strategy - INFO - üéØ Min positions for scale-up: 5
2025-07-23 07:38:55,080 - nGS_Revised_Strategy - INFO - L/S ratio adjustments: ENABLED
2025-07-23 07:38:55,081 - nGS_Revised_Strategy - INFO - Note: Sector management DISABLED - using M/E ratio control instead
2025-07-23 07:38:55,082 - nGS_Revised_Strategy - INFO - Initial M/E ratio with 73 existing positions: 0.00%
2025-07-23 07:38:55,853 - data_manager - INFO - Using cached sector data from 2025-07-23 07:38
2025-07-23 07:38:55,859 - nGS_Revised_Strategy - INFO - Entry AAPL (Technology Hardware, Storage & Peripherals): Engf L NuLo with 25 shares at 198.85
2025-07-23 07:38:57,569 - data_manager - INFO - Saved 1 new trades, total: 4841
2025-07-23 07:38:57,575 - nGS_Revised_Strategy - INFO - Exit AAPL: Gap out L at 202.52, profit: 91.75
2025-07-23 07:38:57,579 - nGS_Revised_Strategy - INFO - Processed AAPL: 120 rows (1/2)
2025-07-23 07:39:00,027 - data_manager - INFO - Saved 1 new trades, total: 4842
2025-07-23 07:39:00,027 - nGS_Revised_Strategy - INFO - Exit MSFT: S ATR X at 415.06, profit: 815.6
2025-07-23 07:39:00,037 - data_manager - INFO - Using cached sector data from 2025-07-23 07:38
2025-07-23 07:39:00,042 - nGS_Revised_Strategy - INFO - Entry MSFT (Systems Software): Engf S with -10 shares at 477.4
2025-07-23 07:39:00,045 - data_manager - INFO - Using cached sector data from 2025-07-23 07:38
2025-07-23 07:39:00,050 - nGS_Revised_Strategy - INFO - Entry MSFT (Systems Software): SemiEng S with -10 shares at 496.62
2025-07-23 07:39:00,054 - nGS_Revised_Strategy - INFO - Processed MSFT: 120 rows (2/2)
2025-07-23 07:39:00,111 - data_manager - INFO - Saved 73 positions within retention period
2025-07-23 07:39:00,111 - nGS_Revised_Strategy - INFO - === END OF DAY M/E REBALANCING CHECK ===
2025-07-23 07:39:00,112 - nGS_Revised_Strategy - INFO - M/E 0.5% < 50.0% with 73 positions: SCALE UP needed
2025-07-23 07:39:00,115 - nGS_Revised_Strategy - INFO - M/E Rebalancing: scale_up with 2.00x scaling factor
2025-07-23 07:39:00,116 - nGS_Revised_Strategy - INFO - Before: M/E 0.5%, 73 positions
2025-07-23 07:39:00,117 - nGS_Revised_Strategy - INFO - After: M/E 89.9%, cash change: $-159,349.21
2025-07-23 07:39:00,117 - nGS_Revised_Strategy - INFO - M/E Rebalancing completed: 73 positions scaled
2025-07-23 07:39:00,118 - nGS_Revised_Strategy - INFO - ‚úÖ M/E rebalancing completed: scale_up
2025-07-23 07:39:00,119 - nGS_Revised_Strategy - INFO - EOD Status: M/E 89.9%, 73 positions, L/S -2.65
2025-07-23 07:39:00,120 - nGS_Revised_Strategy - INFO - === END OF DAY REBALANCING COMPLETE ===
2025-07-23 07:39:00,121 - nGS_Revised_Strategy - INFO - Strategy run complete. Processed 2 symbols, currently have 73 positions
2025-07-23 07:39:00,121 - nGS_Revised_Strategy - INFO - Data retention: 180 days, cutoff: 2025-01-24
2025-07-23 07:39:00,122 - nGS_Revised_Strategy - INFO - üéØ M/E rebalancing: ENABLED
2025-07-23 07:39:00,122 - nGS_Revised_Strategy - INFO - üéØ Final M/E ratio: 89.88%
2025-07-23 07:39:00,123 - nGS_Revised_Strategy - INFO - L/S ratio adjustments: ENABLED
2025-07-23 07:39:00,124 - nGS_Revised_Strategy - INFO - Note: Sector management DISABLED - using M/E ratio control instead
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "c:\ACT\Python NEW 2025\working_backtester_clean.py", line 39, in compare_strategies
    ai_result = self.backtest_ai_strategy(objective, data)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\ACT\Python NEW 2025\working_backtester_clean.py", line 18, in backtest_ai_strategy
    results = strategy.execute_on_data(data, self.indicator_lib)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\ACT\Python NEW 2025\strategy_generator_ai.py", line 43, in execute_on_data
    indicator_data[indicator_name] = indicator_lib.calculate_indicator(
                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\ACT\Python NEW 2025\comprehensive_indicator_library.py", line 517, in calculate_indicator
    return function(df, **params)
           ^^^^^^^^^^^^^^^^^^^^^^
  File "c:\ACT\Python NEW 2025\comprehensive_indicator_library.py", line 274, in bollinger_position
    bb_mid = df['Close'].rolling(window=length).mean()
             ~~^^^^^^^^^
KeyError: 'Close'
üî¨ COMPREHENSIVE COMPARISON
üìä Backtesting Original nGS Strategy

======================================================================
üéØ M/E REBALANCING SYSTEM STATUS
======================================================================
‚úÖ M/E Rebalancing:      ENABLED
‚úÖ M/E Target Range:     50.0% - 80.0%
‚úÖ Min Positions Scale:  5
‚úÖ L/S Ratio Adjust:     ENABLED
‚ùå Sector Management:    DISABLED
======================================================================

======================================================================
üöÄ STARTING STRATEGY RUN - M/E VERIFICATION
======================================================================
üéØ M/E Rebalancing:      ENABLED
üéØ M/E Target Range:     50.0% - 80.0%
üéØ Min Positions Scale:  5
üéØ Initial Positions:    73
üéØ Initial M/E:          0.00%
======================================================================

üéØ CALLING END-OF-DAY M/E REBALANCING...

======================================================================
üéØ END OF DAY M/E REBALANCING CHECK
======================================================================
M/E Rebalancing Status: ENABLED

üéØ M/E REBALANCING CHECK:
   Current M/E:        0.5%
   Target Range:       50.0% - 80.0%
   Position Count:     73
   Min for Scale-Up:   5
üöÄ SCALE UP NEEDED: 0.5% < 50.0% with 73 positions

üéØ PERFORMING M/E REBALANCING:
   Action:             SCALE_UP
   Scaling Factor:     2.000x
   Before M/E:         0.5%
   Positions:          73
   ADBE:  +14 ‚Üí  +28 shares (+14) | $  +5,130
   ACGL: +112 ‚Üí +224 shares (+112) | $  +9,976
   AIZ:  +26 ‚Üí  +52 shares (+26) | $  +4,968
   AVB:  +25 ‚Üí  +50 shares (+25) | $  +5,010
   BR:  +22 ‚Üí  +44 shares (+22) | $  +5,110
   CAH:  +60 ‚Üí +120 shares (+60) | $ +10,058
   CI:  +16 ‚Üí  +32 shares (+16) | $  +4,893
   DRI:  +24 ‚Üí  +48 shares (+24) | $  +4,998
   DVN: +153 ‚Üí +306 shares (+153) | $  +5,015
   EOG:  +81 ‚Üí +162 shares (+81) | $ +10,040
   ESS:  +18 ‚Üí  +36 shares (+18) | $  +4,895
   FFIV:  +34 ‚Üí  +68 shares (+34) | $ +10,056
   HES:  +67 ‚Üí +134 shares (+67) | $ +10,065
   IFF:  +67 ‚Üí +134 shares (+67) | $  +5,031
   NTAP:  +95 ‚Üí +190 shares (+95) | $ +10,043
   NWSA: +335 ‚Üí +670 shares (+335) | $ +10,010
   PM:  +55 ‚Üí +110 shares (+55) | $  +9,954
   PRU:  +48 ‚Üí  +96 shares (+48) | $  +4,950
   RSG:  +21 ‚Üí  +42 shares (+21) | $  +5,051
   TXT: +118 ‚Üí +236 shares (+118) | $  +9,965
   MMM:  -33 ‚Üí  -66 shares (-33) | $  -5,057
   AFL:  -98 ‚Üí -196 shares (-98) | $  -9,987
   APD:  -17 ‚Üí  -34 shares (-17) | $  -4,873
   AMZN:  -23 ‚Üí  -46 shares (-23) | $  -5,045
   ADI:  -21 ‚Üí  -42 shares (-21) | $  -5,049
   ANSS:  -13 ‚Üí  -26 shares (-13) | $  -4,866
   APO:  -33 ‚Üí  -66 shares (-33) | $  -5,016
   CHRW:  -51 ‚Üí -102 shares (-51) | $  -4,971
   CAT:  -12 ‚Üí  -24 shares (-12) | $  -4,965
   CRL:  -32 ‚Üí  -64 shares (-32) | $  -4,941
   SCHW:  -55 ‚Üí -110 shares (-55) | $  -5,039
   COP: -109 ‚Üí -218 shares (-109) | $  -9,989
   CEG:  -16 ‚Üí  -32 shares (-16) | $  -5,088
   DVA:  -35 ‚Üí  -70 shares (-35) | $  -4,964
   DASH:  -21 ‚Üí  -42 shares (-21) | $  -4,998
   DOV:  -27 ‚Üí  -54 shares (-27) | $  -5,051
   DHI:  -38 ‚Üí  -76 shares (-38) | $  -5,012
   EBAY:  -65 ‚Üí -130 shares (-65) | $  -5,019
   EQR: -152 ‚Üí -304 shares (-152) | $  -9,977
   FAST: -116 ‚Üí -232 shares (-116) | $  -5,019
   FE: -251 ‚Üí -502 shares (-251) | $ -10,010
   FCX: -110 ‚Üí -220 shares (-110) | $  -5,015
   GE:  -19 ‚Üí  -38 shares (-19) | $  -4,945
   DOC: -274 ‚Üí -548 shares (-274) | $  -4,995
   HST: -306 ‚Üí -612 shares (-306) | $  -4,997
   HWM:  -27 ‚Üí  -54 shares (-27) | $  -4,976
   INCY:  -73 ‚Üí -146 shares (-73) | $  -4,991
   IQV:  -31 ‚Üí  -62 shares (-31) | $  -5,023
   J:  -37 ‚Üí  -74 shares (-37) | $  -4,948
   MAR:  -18 ‚Üí  -36 shares (-18) | $  -4,948
   MAS:  -78 ‚Üí -156 shares (-78) | $  -5,026
   MRK:  -61 ‚Üí -122 shares (-61) | $  -4,973
   MSFT:  -10 ‚Üí  -20 shares (-10) | $  -4,966
   MHK:  -46 ‚Üí  -92 shares (-46) | $  -4,959
   NDAQ:  -56 ‚Üí -112 shares (-56) | $  -4,961
   NWS: -145 ‚Üí -290 shares (-145) | $  -4,997
   NOC:  -10 ‚Üí  -20 shares (-10) | $  -4,888
   PKG:  -49 ‚Üí  -98 shares (-49) | $  -9,926
   PARA: -389 ‚Üí -778 shares (-389) | $  -4,995
   PYPL:  -68 ‚Üí -136 shares (-68) | $  -4,969
   PHM:  -46 ‚Üí  -92 shares (-46) | $  -5,031
   RJF:  -32 ‚Üí  -64 shares (-32) | $  -5,033
   REG: -144 ‚Üí -288 shares (-144) | $ -10,017
   SMCI:  -95 ‚Üí -190 shares (-95) | $  -5,011
   TROW:  -50 ‚Üí -100 shares (-50) | $  -5,032
   TPR:  -50 ‚Üí -100 shares (-50) | $  -5,034
   TGT:  -49 ‚Üí  -98 shares (-49) | $  -5,008
   TEL:  -28 ‚Üí  -56 shares (-28) | $  -4,933
   TXN:  -23 ‚Üí  -46 shares (-23) | $  -5,022
   TSCO:  -89 ‚Üí -178 shares (-89) | $  -5,014
   TRMB:  -63 ‚Üí -126 shares (-63) | $  -5,007
   UDR: -249 ‚Üí -498 shares (-249) | $  -9,987
   WELL:  -66 ‚Üí -132 shares (-66) | $ -10,006
   After M/E:          89.9%
   Cash Change:        $-159,349
‚úÖ M/E REBALANCING COMPLETED: 73 positions scaled
‚úÖ M/E REBALANCING COMPLETED: SCALE_UP

EOD STATUS:
   Final M/E:          89.9%
   Positions:          73
   L/S Ratio:          -2.65
======================================================================

======================================================================
üéØ FINAL M/E STATUS
======================================================================
Final M/E Ratio:      89.88%
Target Range:         50.0% - 80.0%
Final Positions:      73
Rebalancing System:   ACTIVE

M/E Calculation Details:
Total Open Trade Equity: $899,574.58
Account Value (Cash):    $1,165,030.56
Calculated M/E:         77.21% (should match Final M/E)
M/E Risk Status:        HIGH
M/E Realized P&L:       $907.35
M/E Active Positions:   73
======================================================================
üß™ Backtesting AI strategy: linear_equity

üéØ Generating strategy for objective: LINEAR_EQUITY
‚úÖ Generated strategy 'linear_equity_20250723_073900' with 5 indicators
üìä Entry conditions: 2
üéØ Exit conditions: 2
>>>
>>> print(f"\nÔøΩÔøΩ BACKTEST RESULTS:")print(f"\nÔøΩÔøΩ BACKTEST RESULTS:")
  File "<stdin>", line 1